# Story 1.2: Public Landing Page & Enrollment Form

## Status
Approved

## Story
**As a** Potential Student,
**I want** to view a landing page with course details and submit an enrollment application,
**so that** I can apply for the course.

## Acceptance Criteria
1. A single, mobile-responsive landing page is created that is publicly accessible.
2. The page contains an "Enroll Now" button that reveals an application section.
3. The application section displays bKash payment instructions and a form for Name, Email, and Transaction ID.
4. The system has a configurable **registration capacity** for the batch (read from the courses table).
5. If current pending/approved applications are below the capacity, the form submission is saved to the database with a "pending" status and a confirmation message is shown.
6. If capacity is reached, the form is disabled or shows a "Batch is full" message.
7. If the user is offline, the "Enroll Now" button must be disabled, and a clear message must be displayed informing them that an internet connection is required to apply.

## Tasks / Subtasks
- [ ] Task 1: Create Landing Page Layout & Design (AC: 1, 2)
  - [ ] Create new route at `/` (root page) in `apps/web/app/page.tsx`
  - [ ] Design mobile-responsive layout using Tailwind CSS 3.4.1
  - [ ] Implement "Enroll Now" button with reveal functionality using client-side interactivity
  - [ ] Create course details section with program information
- [ ] Task 2: Create Enrollment Form Component (AC: 2, 3)
  - [ ] Create `EnrollmentForm.tsx` component in `apps/web/components/`
  - [ ] Implement form with Name, Email, Transaction ID fields
  - [ ] Add bKash payment instructions section
  - [ ] Add form validation using shared schemas from `packages/shared/`
- [ ] Task 3: Backend API for Enrollment Management (AC: 4, 5, 6)
  - [ ] Create enrollment data model and database table (extend Cloud SQL schema)
  - [ ] Create `/enrollments` POST endpoint in `apps/api/src/` following service pattern
  - [ ] Implement capacity checking logic with configurable batch size
  - [ ] Create enrollment service with pending status management
- [ ] Task 4: Frontend-Backend Integration (AC: 5, 6)
  - [ ] Integrate form submission with `/enrollments` API endpoint
  - [ ] Implement capacity checking and conditional form display
  - [ ] Add success/error message handling
  - [ ] Test form submission flow end-to-end
- [ ] Task 5: Testing (AC: All)
  - [ ] Write unit tests for EnrollmentForm component using React Testing Library
  - [ ] Write integration tests for enrollment API endpoints using Jest
  - [ ] Write accessibility tests using jest-axe for WCAG 2.1 AA compliance
  - [ ] Test mobile responsiveness and PWA functionality

## Dev Notes

### Previous Story Insights
[Source: Story 1.1] 
The project foundation is complete with Next.js 14.2.3 frontend in `apps/web/` and Express.js 4.19.2 backend in `apps/api/`. The monorepo structure with shared packages is established and CI pipeline is working.

### Architecture Context
[Source: architecture/2-high-level-architecture.md]
- **Frontend Platform:** Progressive Web App (PWA) built with Next.js hosted on Vercel
- **Backend Platform:** Google Cloud Run for synchronous APIs
- **Database Strategy:** Cloud SQL for structured data (user authentication, enrollments) and Firestore for user-generated content

### Tech Stack Requirements
[Source: architecture/3-tech-stack.md]
- **Frontend Framework:** Next.js 14.2.3 with App Router
- **UI Library:** Radix UI ~1.0.0 + Tailwind CSS 3.4.1
- **State Management:** Zustand 4.5.2 for client-side state
- **Language:** TypeScript 5.4.5
- **Server Components:** Components must be Server Components by default, use `'use client'` only when client-side interactivity is required

### Data Models & Database
[Source: architecture/4-data-models.md]
The `courses` table now includes the `capacity` column as per the updated master architecture document.

This story requires creating the new enrollments table:
```sql
CREATE TABLE enrollments (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    course_id UUID NOT NULL REFERENCES courses(id) ON DELETE CASCADE,
    full_name VARCHAR(255) NOT NULL,
    email VARCHAR(255) NOT NULL,
    transaction_id VARCHAR(255) NOT NULL,
    status VARCHAR(20) NOT NULL DEFAULT 'pending', -- 'pending', 'approved', 'rejected'
    created_at TIMESTAMPTZ NOT NULL DEFAULT NOW(),
    updated_at TIMESTAMPTZ NOT NULL DEFAULT NOW()
);
```

### Project Structure Requirements
[Source: architecture/7-unified-project-structure.md]
- **Landing Page:** Modify `apps/web/app/page.tsx` (root route)
- **Components:** Create `apps/web/components/EnrollmentForm.tsx`
- **Backend Service:** Create `apps/api/src/enrollments/` following service pattern:
  - `enrollments.routes.ts` - Express router definitions
  - `enrollments.service.ts` - Business logic
  - `enrollments.validators.ts` - Zod validation schemas
- **Shared Types:** Add enrollment types to `packages/shared/types.ts`
- **Shared Schemas:** Add validation schemas to `packages/shared/schemas.ts`

### API Specification Context
[Source: architecture/5-api-specification.md]
The API should follow the established OpenAPI 3.0.3 pattern:
- POST `/enrollments` endpoint for form submissions
- Request/response schemas following established patterns
- Proper HTTP status codes (201 for creation, 400 for validation errors, 409 for capacity reached)

### Security Requirements
[Source: architecture/6-security.md]
- **API Security:** Rate limiting and CORS policy with Helmet.js security headers
- **Data Validation:** Server-side validation using Zod schemas
- **Input Sanitization:** Protect against XSS and injection attacks
- **TLS:** HTTPS enforcement for data in transit

### PWA Requirements
[Source: architecture/2-high-level-architecture.md, architecture/3-tech-stack.md]
- **PWA Toolkit:** next-pwa 5.6.0 for Progressive Web App features
- **Mobile Responsiveness:** Tailwind CSS responsive design patterns
- **Offline Considerations:** Handle form submissions gracefully when offline

### Testing
[Source: architecture/8-test-strategy-and-standards.md]
- **Test Location:** Co-located with components using `.test.tsx` or `.spec.tsx` extensions
- **Test Standards:** Test Pyramid model with 80% unit test coverage goal
- **Testing Frameworks:** Jest ~29.7.0 and React Testing Library for components
- **API Testing:** Jest for API endpoints with proper database testing
- **Accessibility Testing:** jest-axe for WCAG 2.1 AA compliance
- **Performance Testing:** Lighthouse performance budget checks
- **CI Integration:** All tests must pass before deployment
- **Specific Requirements for this Story:**
  - Unit tests for EnrollmentForm component validation logic
  - Integration tests for enrollment API endpoints
  - Accessibility tests for form fields and error messages
  - Mobile responsiveness tests for PWA functionality

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2025-08-07 | 1.0 | Initial story creation with comprehensive technical context | Bob, SM |
| 2025-08-07 | 1.1 | Fixed data model (moved capacity to courses table), added offline behavior (AC #7) | Bob, SM |
| 2025-08-07 | 1.2 | Restructured testing into dedicated Dev Notes subsection, updated database section per template | Sarah, PO |

## Dev Agent Record

### Agent Model Used
[To be populated by Dev Agent]

### Debug Log References
[To be populated by Dev Agent]

### Completion Notes List
[To be populated by Dev Agent]

### File List
[To be populated by Dev Agent]

## QA Results
[To be populated by QA Agent]